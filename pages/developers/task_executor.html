<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Task Executor &mdash; MECAnywhere DApp  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="prev" title="Developer Guide" href="developer_guide.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            MECAnywhere DApp
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">For Users</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../desktop_guide.html">User Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For Developers</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="developer_guide.html">Developer Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Task Executor</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#resource-control">Resource control</a></li>
<li class="toctree-l2"><a class="reference internal" href="#task">Task</a></li>
<li class="toctree-l2"><a class="reference internal" href="#isolation-support">Isolation support</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gpu-support">GPU support</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cleaning">Cleaning</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/sbip-sg/pymeca">Pymeca github</a></li>
<li class="toctree-l1"><a class="reference external" href="https://sbip-sg.github.io/pymeca/">Pymeca documentation</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/sbip-sg/mecanywhere">MECAnywhere github</a></li>
<li class="toctree-l1"><a class="reference external" href="https://sbip-sg.github.io/mecanywhere/index.html">MECAnywhere documentation</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/sbip-sg/mecanywhere_desktop">MECAnywhere Desktop github</a></li>
<li class="toctree-l1"><a class="reference external" href="https://sbip-sg.github.io/mecanywhere_desktop/index.html">MECAnywhere Desktop documentation</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.youtube.com/watch?v=MDzbEvTyIgQ">Youtube</a></li>
<li class="toctree-l1"><a class="reference external" href="https://drive.google.com/file/d/1mgZ0EfhlHWNPjgXgG-MpgPV32_b0Qx_g/view?usp=sharing">Technical guide video</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">MECAnywhere DApp</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Task Executor</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/pages/developers/task_executor.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="task-executor">
<h1>Task Executor<a class="headerlink" href="#task-executor" title="Link to this heading"></a></h1>
<section id="resource-control">
<h2>Resource control<a class="headerlink" href="#resource-control" title="Link to this heading"></a></h2>
<p>Task executor is configured with the user-specified resource usage for MECAnywhere dispatched task. It contains a resource monitor that monitors the available resources on the host.</p>
</section>
<section id="task">
<h2>Task<a class="headerlink" href="#task" title="Link to this heading"></a></h2>
<p>A task request sent over from MECAnywhere contains the id that defines the computation (In docker context, the image id), the resources it intends to use, the input of the request.</p>
<p>The task executor can manage multiple tasks with different resource usage intents at a given time. Therefore, internally the task executor manages the tasks with an id constructed from both the id and resource in a MECAnywhere request.</p>
<p>By default, if the request does not specify the resource usage intent, it is assumed to work with the default resource usage: 1 CPU core and 128MB RAM. The specified CPU should be a float with one decimal and the RAM is an integer in the unit of MB.</p>
</section>
<section id="isolation-support">
<h2>Isolation support<a class="headerlink" href="#isolation-support" title="Link to this heading"></a></h2>
<p>Task executor now by default uses Docker for isolation. It can also use MicroVM and SGX with additional configurations. The servers to run task with MicroVM or SGX should have the necessary platform software to do so.</p>
<ul class="simple">
<li><p>MicroVM: support by <a class="reference external" href="https://katacontainers.io/">Kata-container</a>. The server shall install kata-container and register kata container runtime to Docker <a class="reference external" href="https://docs.docker.com/engine/alternative-runtimes/">2</a>.</p></li>
<li><p>SGX: support by <a class="reference external" href="https://github.com/intel/linux-sgx">Linux-SGX</a>. The server shall enable SGX support via BIOS and install all the Intel platform software packages, And ensure the Intel AESM service running with systemd.</p></li>
</ul>
</section>
<section id="gpu-support">
<h2>GPU support<a class="headerlink" href="#gpu-support" title="Link to this heading"></a></h2>
<p>Nvidia GPU support uses the <code class="docutils literal notranslate"><span class="pre">NVIDIA/go-nvml</span></code> package to provision local detect and manage GPU devices. The GPU devices shall be mounted to the task executor container so that it is schedulable <a class="reference external" href="https://docs.docker.com/config/containers/resource_constraints/#gpu">4</a>.</p>
</section>
<section id="cleaning">
<h2>Cleaning<a class="headerlink" href="#cleaning" title="Link to this heading"></a></h2>
<p>A task is maintained as a running server on the host machine. It is periodically cleaned by the task executor if they are inactive for a configured threshold of time (default 1min). When there is resource shortage to schedule a new incoming task, previous tasks kept running but not handling request will be removed to free up resources.</p>
</section>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Link to this heading"></a></h2>
<p>When launching the mecanywhere executor container, one can mount a config file to determine the resources limit managed by mecanywhere. A sample config file is <a class="reference external" href="https://github.com/sbip-sg/mecanywhere_desktop/tree/main/task_executor/conf/mecanywhere_docker.yaml">here</a>.</p>
<p>Mount the config file at <code class="docutils literal notranslate"><span class="pre">/app/mecanywhere_executor.yaml</span></code></p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--name<span class="w"> </span>mecanywhere_executor_test<span class="w"> </span>-v<span class="w"> </span>/var/run/docker.sock:/var/run/docker.sock<span class="w"> </span>-v<span class="w"> </span>&lt;your-config-file&gt;:/app/mecanywhere_executor.yaml<span class="w"> </span>--net<span class="o">=</span>mecanywhere<span class="w"> </span>--ip<span class="o">=</span><span class="m">172</span>.18.0.255<span class="w"> </span>mecanywhere-executor:latest
</pre></div>
</div>
<p>Reconfiguration is supported by pausing the executor and passing a new executor configuration file. Currently we the executor type field is ignored, since only docker is supported.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>http://172.18.0.255:2591/pause<span class="w"> </span>-X<span class="w"> </span>POST
curl<span class="w"> </span>http://172.18.0.255:2591/update-config<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;timeout&quot;: 2, &quot;cpu&quot;:2, &quot;mem&quot;:4096, &quot;microVM_runtime&quot;:&quot;kata&quot;}&#39;</span>
curl<span class="w"> </span>http://172.18.0.255:2591/unpause<span class="w"> </span>-X<span class="w"> </span>POST
</pre></div>
</div>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://katacontainers.io/">KataContainers</a></p></li>
<li><p><a class="reference external" href="https://docs.docker.com/engine/alternative-runtimes/">Docker support for Kata Container</a></p></li>
<li><p><a class="reference external" href="https://github.com/intel/linux-sgx">Intel SGX for Linux</a></p></li>
<li><p><a class="reference external" href="https://docs.docker.com/config/containers/resource_constraints/#gpu">Docker GPU support</a></p></li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="developer_guide.html" class="btn btn-neutral float-left" title="Developer Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Junxue.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>